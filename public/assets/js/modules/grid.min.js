export function scrollToCard(e){const t=itemsContainer.querySelector(`.card[data-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("is-highlighted"),setTimeout((()=>t.classList.remove("is-highlighted")),1200))}import*as cardRenderer from"./cardRenderer.js";import{showConfirmationPopover}from"./ui.js";import*as cardManager from"./cardManager.js";let eventHandlers={},muuriGrid=null;const itemsContainer=document.getElementById("grid-view-container"),searchInput=document.getElementById("search-input"),loadingIndicator=document.getElementById("loading-indicator");export function initializeGrid(e){eventHandlers=e,itemsContainer.addEventListener("click",(e=>{const t=e.target,n=t.closest(".card");if(!n)return;if(t.closest(".card-info-layer"))return;const i=t.closest(".action-icon"),r=t.closest(".card-image"),o=n.dataset.id,s=cardManager.getItems().find((e=>e.id===o));s&&(i?i.classList.contains("delete-btn")?showConfirmationPopover({targetElement:i,message:"Deletar este card?",onConfirm:()=>eventHandlers.onDelete(s)}):i.classList.contains("edit-btn")?eventHandlers.onEdit(n,s,itemsContainer):i.classList.contains("save-btn")?eventHandlers.onSave(n,s,itemsContainer):i.classList.contains("cancel-btn")&&(itemsContainer.classList.remove("is-editing-item"),cardRenderer.renderCardViewMode(n,s),n._newImageFile&&delete n._newImageFile,muuriGrid?.layout(!0)):r&&eventHandlers.onView(s))}))}export function setItems(e,t=[]){if(loadingIndicator&&(loadingIndicator.style.display="none"),!muuriGrid)return;const n=muuriGrid.getItems(),i=new Set(n.map((e=>e.getElement().dataset.id))),r=new Set(e.map((e=>e.id))),o=n.filter((e=>!r.has(e.getElement().dataset.id)));o.length>0&&muuriGrid.remove(o,{removeElements:!0});const s=e.filter((e=>!i.has(e.id))).map((e=>cardRenderer.createCardElement(e,t)));n.forEach((n=>{const i=n.getElement();if(r.has(i.dataset.id)){const n=e.find((e=>e.id===i.dataset.id));n&&!i.classList.contains("editing")&&cardRenderer.renderCardViewMode(i,n,t)}})),s.length>0&&muuriGrid.add(s);const a=e.map((e=>e.id));muuriGrid.sort(((e,t)=>a.indexOf(e.getElement().dataset.id)-a.indexOf(t.getElement().dataset.id)),{layout:"instant"})}export function updateFileName(e){const t=e.closest(".file.has-name")?.querySelector(".file-name");t&&(e.files.length>0?t.textContent=e.files[0].name:t.textContent="Nenhuma imagem selecionada")}function initializeMuuri(){itemsContainer?(muuriGrid&&muuriGrid.destroy(),muuriGrid=new Muuri(itemsContainer,{items:".card",dragEnabled:!0,dragStartPredicate:function(e,t){const n=e.getElement();console.log(t);const i=t.target;if(document.body.classList.contains("is-bulk-editing")||n.classList.contains("editing")||n.classList.contains("is-details-visible")||i.closest(".shortcode-hp")||i.closest(".shortcode-count")||i.closest(".shortcode-stat")||i.closest(".toggle-view-icon")||i.closest(".card-actions-top")||i.closest(".card-content .title")||i.closest(".card-content .content"))return!1;const r=n.getBoundingClientRect(),o=t.srcEvent.clientX||t.clientX,s=t.srcEvent.clientY||t.clientY;return!!(o-r.left<15||r.right-o<15||s-r.top<15||r.bottom-s<15)&&Muuri.ItemDrag.defaultStartPredicate(e,t)}}),muuriGrid.on("dragEnd",(()=>{const e=muuriGrid.getItems();console.log("dragEnd event triggered!");const t=e.map((e=>e.getElement().dataset.id));eventHandlers.onReorder&&eventHandlers.onReorder(t)}))):console.error("O contêiner do grid não foi encontrado.")}export function refreshLayout(){muuriGrid?.layout(!0)}export function hide(){muuriGrid&&(muuriGrid.destroy(),muuriGrid=null)}export function destroy(){muuriGrid&&(muuriGrid.destroy(),muuriGrid=null)}export function show(){muuriGrid||initializeMuuri()}