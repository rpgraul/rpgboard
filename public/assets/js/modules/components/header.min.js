function getSiteTitle(){return(window.appSettings||{}).siteTitle||"GameBoard"}function getCurrentPage(){const path=window.location.pathname.toLowerCase();return path.includes("sheet-mode")?"sheet":path.includes("index")?"grid":path.includes("text-mode")?"notas":path.includes("drawing-mode")?"whiteboard":""}export function renderHeader(){const container=document.getElementById("app-header");if(!container)return null;const isNarrator="true"===localStorage.getItem("isNarrator"),storedName=localStorage.getItem("rpgboard_user_name")||"",siteTitle=getSiteTitle(),currentPage=getCurrentPage(),menu=[{id:"nav-login",label:isNarrator?"Mestre":storedName||"Entrar",icon:isNarrator?"fas fa-user-shield":storedName?"fas fa-user-edit":"fas fa-sign-in-alt",action:"login"},{id:"nav-sheet",label:"Ficha",icon:"fas fa-file-invoice",href:"sheet-mode.html",page:"sheet"},{id:"nav-grid",label:"Grid",icon:"fas fa-th",href:"index.html",page:"grid"},{id:"nav-notas",label:"Notas",icon:"fas fa-edit",href:"text-mode.html",page:"notas"},{id:"nav-whiteboard",label:"Whiteboard",icon:"fas fa-pencil-ruler",href:"drawing-mode.html",page:"whiteboard"}];return container.innerHTML=`\n    <header class="top-bar">\n      <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:2rem;">\n        <span class="top-bar-title" id="header-site-title">${siteTitle}</span>\n        <nav class="main-nav" style="display:flex;gap:0.5rem;align-items:center;">\n          ${menu.map((item=>`\n            ${"login"===item.action?`<button id="${item.id}" class="button is-small is-link" style="display:flex;align-items:center;gap:0.3em;">\n                <span class="icon"><i class="${item.icon}"></i></span>\n                <span id="user-name-label">${item.label}</span>\n              </button>`:`<a id="${item.id}" href="${item.href}" class="button is-small${currentPage===item.page?" is-link is-light":" is-link"}" style="display:flex;align-items:center;gap:0.3em;">\n                <span class="icon"><i class="${item.icon}"></i></span>\n                <span>${item.label}</span>\n              </a>`}\n          `)).join("")}\n        </nav>\n      </div>\n    </header>\n    <div id="login-modal" class="modal">\n      <div class="modal-background"></div>\n      <div class="modal-card">\n        <header class="modal-card-head">\n          <p class="modal-card-title">Identificação</p>\n          <button class="delete" aria-label="close"></button>\n        </header>\n        <section class="modal-card-body">\n          <form id="login-form">\n            <div class="field">\n              <label class="label">Seu nome</label>\n              <div class="control has-icons-left">\n                <input id="login-name" class="input" type="text" placeholder="Digite seu nome" maxlength="32" autocomplete="off" ${isNarrator?"disabled":""} value="${isNarrator?"Mestre":storedName||""}">\n                <span class="icon is-small is-left"><i class="fas fa-user"></i></span>\n              </div>\n            </div>\n            <div class="field">\n              <label class="checkbox">\n                <input type="checkbox" id="narrator-checkbox" ${isNarrator?"checked":""}> Entrar como Narrador\n              </label>\n            </div>\n            <div class="field narrator-password-field" style="display:none;">\n              <label class="label">Senha do Narrador</label>\n              <div class="control has-icons-left">\n                <input id="narrator-password" class="input" type="password" placeholder="Senha" autocomplete="off">\n                <span class="icon is-small is-left"><i class="fas fa-lock"></i></span>\n              </div>\n            </div>\n          </form>\n        </section>\n        <footer class="modal-card-foot" style="justify-content:space-between;">\n          <button id="login-save-btn" class="button is-success">Salvar</button>\n          <button id="login-logout-btn" class="button is-danger">Sair</button>\n        </footer>\n      </div>\n    </div>\n  `,setTimeout((()=>setupHeaderEvents()),0),container}function setupHeaderEvents(){const loginBtn=document.getElementById("nav-login"),loginModal=document.getElementById("login-modal"),loginForm=document.getElementById("login-form"),narratorCheckbox=document.getElementById("narrator-checkbox"),narratorPasswordField=loginForm.querySelector(".narrator-password-field"),narratorPasswordInput=document.getElementById("narrator-password"),loginNameInput=document.getElementById("login-name"),saveBtn=document.getElementById("login-save-btn"),logoutBtn=document.getElementById("login-logout-btn"),closeBtn=loginModal.querySelector(".delete"),bg=loginModal.querySelector(".modal-background"),editUserIcon=document.getElementById("edit-user-icon");function openModal(){loginModal.classList.add("is-active"),narratorCheckbox.checked||loginNameInput.focus()}function closeModal(){loginModal.classList.remove("is-active"),narratorPasswordInput.value=""}loginBtn&&(loginBtn.onclick=openModal),editUserIcon&&(editUserIcon.onclick=openModal),closeBtn&&(closeBtn.onclick=closeModal),bg&&(bg.onclick=closeModal),narratorCheckbox.onchange=()=>{narratorCheckbox.checked?(narratorPasswordField.style.display="",loginNameInput.value="Mestre",loginNameInput.disabled=!0,narratorPasswordInput.focus()):(narratorPasswordField.style.display="none",loginNameInput.disabled=!1,"true"===localStorage.getItem("isNarrator")?loginNameInput.value="":loginNameInput.value=localStorage.getItem("rpgboard_user_name")||"")},saveBtn.onclick=e=>{if(e.preventDefault(),narratorCheckbox.checked){const senha=narratorPasswordInput.value.trim();if(!["dimitrinho","tomatinho"].includes(senha))return narratorPasswordInput.classList.add("is-danger"),void narratorPasswordInput.focus();localStorage.setItem("isNarrator","true"),localStorage.setItem("rpgboard_user_name","Mestre")}else{const nome=loginNameInput.value.trim();if(!nome)return loginNameInput.classList.add("is-danger"),void loginNameInput.focus();localStorage.setItem("isNarrator","false"),localStorage.setItem("rpgboard_user_name",nome)}closeModal(),renderHeader()},logoutBtn.onclick=e=>{e.preventDefault(),localStorage.removeItem("isNarrator"),localStorage.removeItem("rpgboard_user_name"),closeModal(),renderHeader()}}export default{renderHeader:renderHeader};