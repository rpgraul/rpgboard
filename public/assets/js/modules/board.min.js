import*as cardRenderer from"./cardRenderer.js";import{showConfirmationPopover}from"./ui.js";import*as cardManager from"./cardManager.js";let filteredItems=[],eventHandlers={};const boardContainer=document.getElementById("board-view-container");let boardSearchInput=null;export function initializeBoard(e){eventHandlers=e,boardContainer?(boardSearchInput=document.getElementById("board-search-input"),boardSearchInput&&boardSearchInput.addEventListener("input",handleSearch),cardManager.subscribe(handleCardsUpdate),boardContainer.addEventListener("click",(e=>{const t=e.target,n=t.closest(".action-icon"),o=t.closest(".card");if(!n||!o)return;const a=o.dataset.id,r=cardManager.getItems().find((e=>e.id===a));r&&(n.classList.contains("view-btn")?eventHandlers.onView(r):n.classList.contains("delete-btn")?showConfirmationPopover({targetElement:n,message:"Deletar este card?",onConfirm:()=>eventHandlers.onDelete(r)}):n.classList.contains("edit-btn")?eventHandlers.onEdit(o,r,boardContainer):n.classList.contains("save-btn")?eventHandlers.onSave(o,r,boardContainer):n.classList.contains("cancel-btn")&&(boardContainer.classList.remove("is-editing-item"),cardRenderer.renderCardViewMode(o,r),o._newImageFile&&delete o._newImageFile))}))):console.error("Board container not found!")}function handleSearch(){const e=boardSearchInput?boardSearchInput.value:"";filteredItems=cardManager.filterItems(e),drawBoard()}function handleCardsUpdate(e){filteredItems=e,drawBoard()}function drawBoard(){if(boardContainer.querySelectorAll(".card").forEach((e=>e.remove())),filteredItems.length>0){const e=filteredItems.map(((e,t)=>{const n=cardRenderer.createCardElement(e);if(n.style.position="absolute",e.boardPosition&&"number"==typeof e.boardPosition.x&&"number"==typeof e.boardPosition.y)n.style.left=e.boardPosition.x+"px",n.style.top=e.boardPosition.y+"px";else{const e=80+30*t,o=40+30*t;n.style.top=`${e}px`,n.style.left=`${o}px`}let o=!1,a=0,r=0;return n.addEventListener("mousedown",(function(e){0===e.button&&(o=!0,n.style.zIndex=10,a=e.clientX-n.offsetLeft,r=e.clientY-n.offsetTop,document.body.style.userSelect="none")})),document.addEventListener("mousemove",(function(e){o&&(n.style.left=e.clientX-a+"px",n.style.top=e.clientY-r+"px")})),document.addEventListener("mouseup",(async function(t){if(o){o=!1,n.style.zIndex=1,document.body.style.userSelect="";const t=n.offsetLeft,a=n.offsetTop;await cardManager.updateItemPosition(e.id,{x:t,y:a})}})),n}));boardContainer.append(...e)}}