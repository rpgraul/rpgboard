import*as cardRenderer from"./cardRenderer.js";import{showConfirmationPopover}from"./ui.js";import*as cardManager from"./cardManager.js";let eventHandlers={};const boardContainer=document.getElementById("board-view-container");export function initializeBoard(e){eventHandlers=e,boardContainer?boardContainer.addEventListener("click",(e=>{const t=e.target,n=t.closest(".action-icon"),o=t.closest(".card");if(!n||!o)return;const s=o.dataset.id,a=cardManager.getItems().find((e=>e.id===s));a&&(n.classList.contains("view-btn")?eventHandlers.onView(a):n.classList.contains("delete-btn")?showConfirmationPopover({targetElement:n,message:"Deletar este card?",onConfirm:()=>eventHandlers.onDelete(a)}):n.classList.contains("edit-btn")?eventHandlers.onEdit(o,a,boardContainer):n.classList.contains("save-btn")?eventHandlers.onSave(o,a,boardContainer):n.classList.contains("cancel-btn")&&(boardContainer.classList.remove("is-editing-item"),cardRenderer.renderCardViewMode(o,a),o._newImageFile&&delete o._newImageFile))})):console.error("Board container not found!")}export function setItems(e){boardContainer.querySelectorAll(".card").forEach((e=>e.remove()));const t=document.getElementById("board-search-input");if(0===e.length&&t?.value){const e=document.createElement("div");e.innerHTML='<div class="column is-full has-text-centered has-text-white"><p class="is-size-5">Nenhum item encontrado.</p></div>',boardContainer.appendChild(e)}else if(e.length>0){const t=e.map(((e,t)=>{const n=cardRenderer.createCardElement(e);if(n.style.position="absolute",e.boardPosition&&"number"==typeof e.boardPosition.x&&"number"==typeof e.boardPosition.y)n.style.left=e.boardPosition.x+"px",n.style.top=e.boardPosition.y+"px";else{const e=80+30*t,o=40+30*t;n.style.top=`${e}px`,n.style.left=`${o}px`}let o=!1,s=0,a=0;return n.addEventListener("mousedown",(function(e){0===e.button&&(o=!0,n.style.zIndex=10,s=e.clientX-n.offsetLeft,a=e.clientY-n.offsetTop,document.body.style.userSelect="none")})),document.addEventListener("mousemove",(function(e){o&&(n.style.left=e.clientX-s+"px",n.style.top=e.clientY-a+"px")})),document.addEventListener("mouseup",(async function(t){if(o){o=!1,n.style.zIndex=1,document.body.style.userSelect="";const t=n.offsetLeft,s=n.offsetTop;eventHandlers.onPositionChange&&eventHandlers.onPositionChange(e.id,{x:t,y:s})}})),n}));boardContainer.append(...t)}}