document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("text-input"),t=document.getElementById("json-output"),s=document.getElementById("convert-btn"),n=document.getElementById("copy-btn"),i=document.getElementById("goto-upload-btn"),o=document.getElementById("notification-area"),a=document.getElementById("show-prompt-btn"),c=document.getElementById("ai-prompt-modal");function d(e,t="is-success"){o.innerHTML=`\n            <div class="notification ${t}">\n                <button class="delete"></button>\n                ${e}\n            </div>\n        `,o.querySelector(".delete")?.addEventListener("click",(()=>{o.innerHTML=""}))}s.addEventListener("click",(function(){const s=e.value.trim();if(!s)return void d("O campo de texto não pode estar vazio.","is-warning");o.innerHTML="",t.value="",n.classList.add("is-hidden"),i.classList.add("is-hidden");const a=s.split(/^\s*---\s*$/m),c=[];let r=!1;a.forEach(((e,t)=>{const s=e.trim();if(!s)return;const n={};if(s.split("\n").forEach((e=>{const t=e.match(/^([^:]+):\s*(.*)$/);if(t){const e=t[1].trim(),s=t[2].trim();n[e]=s}})),!n.titulo)return d(`Erro no Card #${t+1}: O campo 'titulo' é obrigatório.`,"is-danger"),void(r=!0);n.tags&&(n.tags=n.tags.split(",").map((e=>e.trim())).filter(Boolean)),n.hasOwnProperty("isVisibleToPlayers")&&(n.isVisibleToPlayers="false"!==n.isVisibleToPlayers.toLowerCase()),c.push(n)})),r||(c.length>0?(t.value=JSON.stringify(c,null,2),n.classList.remove("is-hidden"),i.classList.remove("is-hidden"),d(`${c.length} card(s) convertido(s) com sucesso!`,"is-success")):d("Nenhum card válido foi encontrado no texto.","is-warning"))})),n.addEventListener("click",(async function(){if(t.value)try{await navigator.clipboard.writeText(t.value),n.textContent="Copiado!",n.classList.remove("is-success"),n.classList.add("is-info"),setTimeout((()=>{n.innerHTML='<span class="icon"><i class="fas fa-copy"></i></span><span>Copiar JSON</span>',n.classList.remove("is-info"),n.classList.add("is-success")}),2e3)}catch(e){d("Falha ao copiar o texto.","is-danger"),console.error("Erro ao copiar:",e)}})),function(){if(!a||!c)return;const e=c.querySelectorAll(".modal-background, .delete");a.addEventListener("click",(()=>{c.classList.add("is-active")})),e.forEach((e=>{e.addEventListener("click",(()=>{c.classList.remove("is-active")}))}))}(),document.body.addEventListener("click",(async e=>{const t=e.target.closest("pre > code");t&&(await navigator.clipboard.writeText(t.textContent),function(e,t="Copiado!"){const s=document.createElement("div");s.textContent=t,s.className="click-feedback",document.body.appendChild(s),s.style.left=`${e.pageX+15}px`,s.style.top=`${e.pageY}px`,setTimeout((()=>{s.style.opacity="0",setTimeout((()=>{s.remove()}),500)}),700)}(e))}))}));