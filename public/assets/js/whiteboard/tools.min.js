import{canvas}from"./canvas.js";let currentMode="select",lastActiveMode="select",currentColor="#000000",currentWidth=3;export function initializeTools(){const colorPicker=document.getElementById("wb-color"),widthPicker=document.getElementById("wb-width");document.querySelectorAll(".tool-btn[data-tool]").forEach((btn=>{btn.addEventListener("click",(()=>{const mode=btn.dataset.tool;lastActiveMode=mode,setMode(mode)}))})),colorPicker&&colorPicker.addEventListener("input",(e=>{currentColor=e.target.value,updateActiveObjectStyle(),updateBrush()})),widthPicker&&widthPicker.addEventListener("input",(e=>{currentWidth=parseInt(e.target.value,10),updateBrush()}))}export function setMode(mode,isTemporary=!1){currentMode=mode,document.querySelectorAll(".tool-btn").forEach((b=>b.classList.remove("is-active")));const activeBtn=document.querySelector(`.tool-btn[data-tool="${mode}"]`);activeBtn&&activeBtn.classList.add("is-active"),canvas.isDrawingMode="draw"===mode,canvas.selection="select"===mode,"move"===mode?(canvas.forEachObject((o=>{o.selectable=!1,o.evented=!1})),canvas.discardActiveObject()):canvas.forEachObject((o=>{o.selectable=!0,o.evented=!0})),"draw"===mode&&updateBrush(),updateVisualCursor(),canvas.requestRenderAll()}export function restorePreviousMode(){setMode(lastActiveMode)}export function updateVisualCursor(){if(!canvas||!canvas.upperCanvasEl)return;const el=canvas.upperCanvasEl,btnDown=window._isPointerDown;el.classList.remove("cursor-grab","cursor-grabbing","cursor-text","cursor-crosshair");let cursor="default";"move"===currentMode?btnDown?(cursor="grabbing",el.classList.add("cursor-grabbing")):(cursor="grab",el.classList.add("cursor-grab")):"text"===currentMode?(cursor="text",el.classList.add("cursor-text")):"draw"===currentMode&&(cursor="crosshair",el.classList.add("cursor-crosshair")),canvas.defaultCursor=cursor,canvas.setCursor(cursor),canvas.requestRenderAll()}function updateBrush(){canvas.freeDrawingBrush||(canvas.freeDrawingBrush=new fabric.PencilBrush(canvas)),canvas.freeDrawingBrush.color=currentColor,canvas.freeDrawingBrush.width=currentWidth}function updateActiveObjectStyle(){const active=canvas.getActiveObject();active&&("i-text"===active.type?active.set("fill",currentColor):active.set&&(active.stroke&&active.set("stroke",currentColor),active.fill&&"transparent"!==active.fill&&"image"!==active.type&&active.set("fill",currentColor)),canvas.requestRenderAll())}export function getCurrentState(){return{mode:currentMode,color:currentColor,width:currentWidth}}