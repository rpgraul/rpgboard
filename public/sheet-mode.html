<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modo Ficha - GameBoard</title>
    <link rel="stylesheet" href="https://jenil.github.io/bulmaswatch/cyborg/bulmaswatch.min.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/sheet-mode.css">
    <link rel="stylesheet" href="assets/css/shortcodes.css">
    <link rel="stylesheet" href="assets/css/chat.css">
    <link rel="stylesheet" href="assets/css/rpg-dice.css">
    <link rel="stylesheet" href="assets/css/tiptap-editor.css">
    <link rel="stylesheet" href="assets/css/tiptap-toolbar.css">
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"></script>
    <script type="importmap">
        {
            "imports": {
                "firebase/app": "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js",
                "firebase/firestore": "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js",
                "firebase/storage": "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js",
                "@tiptap/core": "https://esm.sh/@tiptap/core@2.2.4",
                "@tiptap/starter-kit": "https://esm.sh/@tiptap/starter-kit@2.2.4",
                "@tiptap/extension-link": "https://esm.sh/@tiptap/extension-link@2.2.4",
                "@tiptap/extension-highlight": "https://esm.sh/@tiptap/extension-highlight@2.2.4",
                "@tiptap/extension-underline": "https://esm.sh/@tiptap/extension-underline@2.2.4",
                "@tiptap/extension-text-align": "https://esm.sh/@tiptap/extension-text-align@2.2.4",
                "@tiptap/suggestion": "https://esm.sh/@tiptap/suggestion@2.2.4"
            }
        }
    </script>
</head>
<body>
  <div id="app-header"></div>
  <div id="app-overlays"></div>
  <div id="app-fab"></div>
  <div id="app-wrapper">
    <div class="sheet-layout">
      <!-- O conteúdo da ficha será injetado dinamicamente pelo JS -->
    </div>
  </div>
  <!-- Modais essenciais -->
  <div id="char-selection-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Selecione seu Personagem</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section id="char-selection-body" class="modal-card-body">
        <p>Carregando...</p>
      </section>
    </div>
  </div>
  <div id="macro-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Criar Macro</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="field">
          <label class="label">Nome do Macro</label>
          <div class="control">
            <input id="macro-name" class="input" type="text" placeholder="Ex: Ataque Espada">
          </div>
        </div>
        <div class="field">
          <label class="label">Comando</label>
          <div class="control">
            <input id="macro-command" class="input" type="text" placeholder="Ex: /r 1d20+forca">
          </div>
          <p class="help">Use nomes de atributos definidos em [stat "forca" "3"] para somar automaticamente.</p>
        </div>
      </section>
      <footer class="modal-card-foot">
        <button id="save-macro-btn" class="button is-success">Salvar Macro</button>
        <button class="button modal-cancel">Cancelar</button>
      </footer>
    </div>
  </div>
  <div id="content-editor-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card" style="width: 90%; max-width: 1000px;">
      <header class="modal-card-head">
        <p class="modal-card-title">Editar Conteúdo</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body" style="height: 500px; display: flex; flex-direction: column;">
        <div id="content-tiptap-wrapper" class="tiptap-editor-wrapper" style="flex: 1; display: flex; flex-direction: column;">
          <!-- Editor será injetado pelo JS -->
        </div>
      </section>
      <footer class="modal-card-foot">
        <button id="save-content-btn" class="button is-success">Salvar</button>
        <button class="button modal-cancel">Cancelar</button>
      </footer>
    </div>
  </div>
  <div id="shortcode-generator-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Shortcode</p>
        <button class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <form id="shortcode-generator-form">
          <div class="field">
            <label class="label">Tipo de Shortcode</label>
            <div class="control">
              <div class="select is-fullwidth">
                <select id="shortcode-type">
                  <option value="">Selecione um tipo</option>
                  <option value="stat">Status ([stat])</option>
                  <option value="hp">HP ([hp])</option>
                  <option value="count">Contador ([count])</option>
                  <option value="money">Dinheiro ([money])</option>
                  <option value="container">Container ([container])</option>
                </select>
              </div>
            </div>
          </div>

          <div id="shortcode-options-stat" class="shortcode-options is-hidden">
            <div class="field">
              <label class="label">Rótulo</label>
              <div class="control">
                <input class="input" type="text" id="stat-label" placeholder="Ex: Força, Destreza">
              </div>
            </div>
            <div class="field">
              <label class="label">Valor</label>
              <div class="control">
                <input class="input" type="text" id="stat-value" placeholder="10">
              </div>
            </div>
          </div>

          <div id="shortcode-options-hp" class="shortcode-options is-hidden">
            <div class="field">
              <label class="label">HP Máximo</label>
              <div class="control">
                <input class="input" type="number" id="hp-max" placeholder="100">
              </div>
            </div>
            <div class="field">
              <label class="label">HP Atual</label>
              <div class="control">
                <input class="input" type="number" id="hp-current" placeholder="100">
              </div>
            </div>
          </div>

          <div id="shortcode-options-count" class="shortcode-options is-hidden">
            <div class="field">
              <label class="label">Rótulo</label>
              <div class="control">
                <input class="input" type="text" id="count-label" placeholder="Ex: Poções, Flechas">
              </div>
            </div>
            <div class="field">
              <label class="label">Quantidade Atual</label>
              <div class="control">
                <input class="input" type="number" id="count-value" placeholder="0">
              </div>
            </div>
            <div class="field">
              <label class="label">Máximo</label>
              <div class="control">
                <input class="input" type="number" id="count-max" placeholder="0">
              </div>
            </div>
            <div class="field">
              <label class="checkbox">
                <input type="checkbox" id="count-overlay">
                Destacar no Overlay (*)
              </label>
            </div>
          </div>

          <div id="shortcode-options-money" class="shortcode-options is-hidden">
            <div class="field">
              <label class="label">Quantidade</label>
              <div class="control">
                <input class="input" type="number" id="money-value" placeholder="0">
              </div>
            </div>
            <div class="field">
              <label class="label">Moeda (Opcional)</label>
              <div class="control">
                <input class="input" type="text" id="money-currency" placeholder="Ex: GP, $ (Deixe vazio para padrão)">
              </div>
            </div>
          </div>

          <div id="shortcode-options-container" class="shortcode-options is-hidden">
            <div class="field">
              <label class="label">Rótulo / Título</label>
              <div class="control">
                <input class="input" type="text" id="container-label" placeholder="Ex: Mochila, Magias">
              </div>
            </div>
            <div class="field">
              <label class="label">Tipo (Ícone/Cor)</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select id="container-type">
                    <option value="default">Padrão</option>
                    <option value="inventory">Inventário</option>
                    <option value="spells">Magias</option>
                    <option value="skills">Habilidades</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div id="shortcode-common-options" class="is-hidden mt-4 pt-4" style="border-top: 1px solid #444;">
            <div class="field">
              <label class="label">Posição</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select id="shortcode-position">
                    <option value="">Padrão</option>
                    <option value="left">Esquerda (Overlay)</option>
                    <option value="right">Direita (Overlay)</option>
                    <option value="bottom">Baixo (Overlay)</option>
                    <option value="top">Topo (Overlay)</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="field narrator-only is-hidden">
              <label class="checkbox has-text-danger">
                <input type="checkbox" id="shortcode-hidden">
                Oculto dos Jogadores (#)
              </label>
            </div>
          </div>
        </form>
      </section>
      <footer class="modal-card-foot">
        <button id="shortcode-insert-btn" class="button is-success">Salvar/Inserir</button>
        <button class="button modal-cancel">Cancelar</button>
      </footer>
    </div>
  </div>
  <script type="module" src="assets/js/firebase-config.js"></script>
  <script type="module" src="assets/js/sheet-mode.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
</body>
</html>