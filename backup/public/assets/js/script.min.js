import{initializeModals,openModal,closeModal}from"./modules/modal.js";import*as auth from"./modules/auth.js";import*as firebaseService from"./modules/firebaseService.js";import*as narrator from"./modules/narrator.js";import*as bulkEdit from"./modules/bulkEdit.js";import*as settings from"./modules/settings.js";import*as grid from"./modules/grid.js";import*as board from"./modules/board.js";import*as cardRenderer from"./modules/cardRenderer.js";import*as shortcodeParser from"./modules/shortcodeParser.js";import*as diceRoller from"./modules/diceRoller.js";let allItems=[],tagSuggestionsContainer=null,isInitialGridLoaded=!1,appSettings={};const VISIBILITY_FILTERS={VISIBLE:"visible",HIDDEN:"hidden"};function normalizeString(e){return e?e.toString().toLowerCase().normalize("NFD").replace(/[̀-ͯ]/g,""):""}function generateTagFilters(e,t){if(!t||!Array.isArray(e))return;const a=t.querySelector(".narrator-only");e.forEach((e=>{const o=document.createElement("div");o.className="control",o.innerHTML=`\n            <label class="checkbox">\n                <input type="checkbox" value="${e.value}">\n                <span>${e.label}</span>\n            </label>\n        `,t.insertBefore(o,a)}))}function injectDragDropStyles(){const e=document.createElement("style");e.textContent='\n        /* Adiciona o cursor de "agarrar" aos cards que podem ser arrastados */\n        .card.muuri-item-draggable {\n            cursor: grab;\n        }\n        .card.muuri-item-dragging {\n            cursor: grabbing;\n        }\n        /* Reseta o cursor para o conteúdo interno, fazendo com que a "alça" seja a borda/padding do card */\n        .card.muuri-item-draggable .card-content,\n        .card.muuri-item-draggable .card-image,\n        .card.muuri-item-draggable .card-actions-top,\n        .card.muuri-item-draggable .card-info-layer {\n            cursor: auto;\n        }\n    ',document.head.appendChild(e)}import*as cardManager from"./modules/cardManager.js";async function updateUserState(e){const t=document.getElementById("user-login-btn"),a=document.getElementById("user-name");if(e){localStorage.setItem("rpgboard_user_name",e),t.style.display="none",a.textContent=e,a.style.display="inline";try{await firebaseService.saveUser(e)}catch(e){console.error("Erro ao salvar usuário no Firebase:",e)}}else localStorage.removeItem("rpgboard_user_name"),t.style.display="inline-flex",a.style.display="none"}document.addEventListener("DOMContentLoaded",(async()=>{const e=localStorage.getItem("rpgboard_user_name");e&&updateUserState(e);const t=document.getElementById("fab-toggle-view"),a=document.getElementById("fab-add-card"),o=document.getElementById("fab-help"),n=document.getElementById("fab-bulk-edit"),s=document.getElementById("search-input"),i=document.getElementById("active-filters-container"),r=document.getElementById("board-search-input"),d=document.getElementById("clear-filters-btn"),c=document.getElementById("tag-filters"),l=document.getElementById("view-wrapper"),u=document.querySelector(".top-bar-title"),m=(document.getElementById("narrator-login-btn"),document.getElementById("detail-modal")),g=document.getElementById("add-card-modal"),p=document.getElementById("help-modal"),v=document.getElementById("form-add-card"),h=(document.getElementById("fab-settings"),document.getElementById("card-arquivo")),y=document.getElementById("card-tags"),f=document.getElementById("grid-view-container"),b=document.getElementById("board-view-container"),I=document.getElementById("user-login-btn"),E=document.getElementById("user-login-modal"),S=document.getElementById("form-user-login"),L=document.getElementById("user-name-input"),w=document.getElementById("roll-dice-btn"),k=document.getElementById("dice-modal"),B=document.querySelectorAll(".dice-option");I.addEventListener("click",(()=>{openModal(E)})),S.addEventListener("submit",(e=>{e.preventDefault();const t=L.value.trim();t&&(updateUserState(t),closeModal(E),L.value="")})),w.addEventListener("click",(()=>{openModal(k)})),B.forEach((e=>{e.addEventListener("click",(()=>{const t=parseInt(e.dataset.dice.replace("d","")),a=diceRoller.rollDice(t),o=localStorage.getItem("rpgboard_user_name")||"Visitante";diceRoller.showDiceResult(a,o),closeModal(k)}))})),injectDragDropStyles();try{appSettings=await firebaseService.getSettings(),u&&(u.textContent=appSettings.siteTitle),document.title=`${appSettings.siteTitle} - GameBoard`,cardRenderer.initializeCardRenderer(appSettings),generateTagFilters(appSettings.filters,c)}catch(e){console.error("Falha ao carregar as configurações do site:",e)}function C(e){narrator.updateNarratorUI(e),document.body.classList.toggle("master-view",e)}function T(e,t,a){a.classList.add("is-editing-item"),cardRenderer.renderCardEditMode(e,t,N);const o=e.querySelector(".edit-image-input");o&&o.addEventListener("change",(()=>{if(o.files&&o.files[0]){const t=o.files[0],a=new FileReader,n=e.querySelector(".card-image .image"),s=n.querySelector("img");e.querySelector(".card-image").classList.remove("is-placeholder"),a.onload=e=>{s.src=e.target.result},a.readAsDataURL(t),cardRenderer.getImageDimensions(t).then((e=>{const t=e.height/e.width*100;n.style.paddingBottom=`${t}%`,grid.refreshLayout()})),e._newImageFile=t}}))}async function x(e,t){const a=cardRenderer.getCardFormData(e),o=e._newImageFile||null;try{if(o){const e=await cardRenderer.getImageDimensions(o);a.width=e.width,a.height=e.height}return await firebaseService.updateItem(t,a,o),e._newImageFile&&delete e._newImageFile,{...t,...a}}catch(e){throw console.error("Falha ao salvar as alterações:",e),alert("Falha ao salvar as alterações."),e}}async function M(e,t,a,o=null){const n=allItems.find((t=>t.id===e));if(!n||!n.conteudo)return void console.error("Item não encontrado para atualização de shortcode:",e);if(o){const e=o.closest(".shortcode-hp, .shortcode-count");e&&(e.classList.add("is-updating"),setTimeout((()=>e.classList.remove("is-updating")),700))}const s=decodeURIComponent(t);let i;i=/current=/.test(s)?s.replace(/current=("|)(\d+)("|)/,`current="${a}"`):s.replace(/]$/,` current="${a}"]`);const r=n.conteudo.replace(s,i);try{await firebaseService.updateItem(n,{conteudo:r})}catch(e){console.error("Falha ao atualizar shortcode:",e),alert("Falha ao salvar a alteração.")}}l.classList.add("view-grid"),await auth.initializeAuth(),await cardManager.initialize({onDelete:V,onEdit:T,onSave:x,onView:D,onTagInputInit:e=>$(e,{suggestions:appSettings.recommendedTags||[]}),gridContainer:f,boardContainer:b}),auth.initializeAuth(),bulkEdit.initializeBulkEdit(),settings.initializeSettings(),C(auth.isNarrator()),window.addEventListener("narratorStatusChange",(()=>{const e=auth.isNarrator();C(e),e||bulkEdit.exitBulkEditMode(),q()}));const N={onDelete:V,onEdit:T,onSave:x,onView:D,onTagInputInit:e=>$(e,{suggestions:appSettings.recommendedTags||[]}),onPositionChange:async function(e,t){await firebaseService.updateItem({id:e},{boardPosition:t})},onReorder:async function(e){try{await firebaseService.updateItemsOrder(e)}catch(e){console.error("Failed to update card order:",e),alert("Failed to save the new card order.")}}};function q(){const e=s.value.trim(),t=Array.from(c.querySelectorAll('input:not([value="visible"]):not([value="hidden"]):checked')).map((e=>e.value)),a=normalizeString(e),o=c.querySelector(`input[value="${VISIBILITY_FILTERS.VISIBLE}"]`)?.checked,n=c.querySelector(`input[value="${VISIBILITY_FILTERS.HIDDEN}"]`)?.checked,i=document.querySelector(".loading-indicator");i&&i.remove();const r=allItems.filter((e=>{const s=!a||normalizeString(e.titulo||"").includes(a)||normalizeString(e.conteudo||"").includes(a)||normalizeString(e.descricao||"").includes(a)||e.tags.some((e=>normalizeString(e).includes(a))),i=0===t.length||t.every((t=>e.tags.some((e=>normalizeString(e)===t))));let r=!0;return auth.isNarrator()&&(o||n)&&(o&&!n?r=!1!==e.isVisibleToPlayers:!o&&n&&(r=!1===e.isVisibleToPlayers)),s&&i&&r}));l.classList.contains("view-grid")&&grid.setItems(r,t),l.classList.contains("view-board")&&board.setItems(r,t)}function F(){const e=""!==s.value.trim(),t=null!==c.querySelector("input:checked");d&&d.classList.toggle("is-hidden",!e&&!t)}function z(){i.innerHTML="";c.querySelectorAll("input:checked").forEach((e=>{const t=document.createElement("div");t.className="tags has-addons",t.innerHTML=`\n                <span class="tag is-link">${e.nextElementSibling.textContent}</span>\n                <a class="tag is-delete" data-value="${e.value}"></a>\n            `,i.appendChild(t)}))}function $(e,t={}){const{isMultiTag:a=!0,suggestions:o=appSettings.recommendedTags||[],showRecsOnFocus:n=!0}=t;tagSuggestionsContainer||(tagSuggestionsContainer=document.createElement("div"),tagSuggestionsContainer.className="tag-suggestions",document.body.appendChild(tagSuggestionsContainer));const s=t=>{if(tagSuggestionsContainer.innerHTML="",0===t.length)return void i();t.forEach((e=>{const t=document.createElement("div");t.className="tag-suggestion-item",t.textContent=e,t.addEventListener("mousedown",(t=>{t.preventDefault(),r(e)})),tagSuggestionsContainer.appendChild(t)}));const a=e.getBoundingClientRect();tagSuggestionsContainer.style.left=`${a.left+window.scrollX}px`,tagSuggestionsContainer.style.top=`${a.bottom+window.scrollY+2}px`,tagSuggestionsContainer.style.width=`${a.width}px`,tagSuggestionsContainer.style.display="block"},i=()=>{tagSuggestionsContainer&&(tagSuggestionsContainer.style.display="none")},r=t=>{if(a){const a=e.value.split(",").map((e=>e.trim()));a[a.length-1]=t,e.value=a.join(", ")+", "}else e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0}));i(),e.focus()};e.addEventListener("focus",(()=>{const t=e.value.trim();n&&(""===t||a&&t.endsWith(","))&&s(o)})),e.addEventListener("input",(()=>{let t;if(a){const a=e.value.split(",").map((e=>e.trim()));t=normalizeString(a[a.length-1])}else t=normalizeString(e.value);if(!t)return void(n?s(o):i());const r=[...new Set(allItems.flatMap((e=>e.tags||[])))].filter((e=>e&&normalizeString(e).includes(t)));s(r)})),e.addEventListener("blur",(()=>setTimeout(i,150)))}function R(e){localStorage.setItem("rpgboard_view_mode",e)}function D(e){if(!e||!m)return;const t=m.querySelector(".modal-content");t.innerHTML="";const a=document.createElement("div");a.className="box",a.dataset.itemId=e.id;let o="",n="";if(n+=`<h2 class="title is-3">${e.titulo}</h2>`,e.conteudo){const t=shortcodeParser.parseAllShortcodes(e),a=(t.left||"")+(t.right||"")+(t.bottom||"")+(t.details||"");a&&(n+=`<div class="content modal-shortcodes">${a}</div>`)}if(e.descricao&&(n+=`<hr><div class="content is-small"><strong>Descrição:</strong><br>${e.descricao.replace(/\n/g,"<br>")}\n</div>`),e.url){o=`<div class="modal-image-container"><img src="${e.url}" alt="${e.titulo}"></div>`;const t=e.height>e.width;a.classList.add(t?"is-layout-vertical":"is-layout-horizontal")}else a.classList.add("is-layout-horizontal");a.innerHTML=`${o}<div class="modal-text-container">${n}</div>`,t.appendChild(a),openModal(m)}function V(e){firebaseService.deleteItem(e).catch((e=>{console.error("Falha ao deletar item no backend:",e),alert("Ocorreu um erro ao deletar o item.")}))}function _(){const e=document.getElementById("board-view-container");if(!e)return;if(e.querySelector(".board-zoom-wrapper"))return;const t=document.createElement("div");t.className="board-zoom-wrapper";const a=document.createElement("div");for(a.className="board-pan-wrapper";e.firstChild;)a.appendChild(e.firstChild);t.appendChild(a),e.appendChild(t);let o,n,s=1,i=0,r=0,d=!1;function c(){t.style.transform=`scale(${s}) translate(${i/s}px, ${r/s}px)`}if(!document.getElementById("board-zoom-in")){const t=document.createElement("button");t.id="board-zoom-in",t.textContent="+",t.style.position="absolute",t.style.top="10px",t.style.right="60px",t.style.zIndex="20",t.className="button is-link",t.onclick=function(){s=Math.min(s+.1,2),c()},e.appendChild(t)}if(!document.getElementById("board-zoom-out")){const t=document.createElement("button");t.id="board-zoom-out",t.textContent="-",t.style.position="absolute",t.style.top="10px",t.style.right="10px",t.style.zIndex="20",t.className="button is-link",t.onclick=function(){s=Math.max(s-.1,.5),c()},e.appendChild(t)}a.addEventListener("mousedown",(e=>{d=!0,o=e.clientX-i,n=e.clientY-r,a.style.cursor="grabbing"})),document.addEventListener("mousemove",(e=>{d&&(i=e.clientX-o,r=e.clientY-n,c())})),document.addEventListener("mouseup",(()=>{d=!1,a.style.cursor="grab"})),a.addEventListener("touchstart",(e=>{1===e.touches.length&&(d=!0,o=e.touches[0].clientX-i,n=e.touches[0].clientY-r)})),document.addEventListener("touchmove",(e=>{d&&1===e.touches.length&&(i=e.touches[0].clientX-o,r=e.touches[0].clientY-n,c())})),document.addEventListener("touchend",(()=>{d=!1})),document.addEventListener("keydown",(e=>{document.body.classList.contains("body-view-board")&&("w"===e.key&&(r-=40),"s"===e.key&&(r+=40),"a"===e.key&&(i-=40),"d"===e.key&&(i+=40),c())})),c()}initializeModals(),grid.initializeGrid(N),board.initializeBoard(N),document.body.addEventListener("click",(e=>{const t=e.target,a=document.querySelector(".money-value-input:not(.is-hidden)");if(a&&!a.contains(t)&&!t.closest(".shortcode-money")){const e=a.closest(".shortcode-money").querySelector(".money-value-display");a.classList.add("is-hidden"),e.classList.remove("is-hidden")}const o=t.closest(".card-link");if(o){e.stopPropagation();const t=o.dataset.cardName;if(t){const e=normalizeString(t),a=allItems.find((t=>normalizeString(t.titulo)===e));a&&D(a)}return}const n=t.closest(".count-btn, .count-checkbox");if(n){e.stopPropagation();const t=n.closest(".shortcode-count");if(!t)return;const{itemId:a,shortcode:o}=t.dataset;if(a&&o){const e=decodeURIComponent(o),t=e.match(/max=(?:'|')?(\d+)(?:'|')?/),s=e.match(/current=(?:'|')?(\d+)(?:'|')?/),i=t?parseInt(t[1],10):0;let r=s?parseInt(s[1],10):0,d=r;if(n.classList.contains("count-btn")){const e=n.dataset.action;"increment"===e?d=Math.min(r+1,i):"decrement"===e&&(d=Math.max(r-1,0))}else if(n.classList.contains("count-checkbox")){const e=parseInt(n.dataset.value,10);d=e===r?0:e}M(a,o,d,n)}return}const s=t.closest(".shortcode-money .money-value-display");if(s){e.stopPropagation();const t=s.closest(".shortcode-money").querySelector(".money-value-input");return s.classList.add("is-hidden"),t.classList.remove("is-hidden"),t.focus(),void t.select()}if(bulkEdit.isBulkEditingActive()){const e=t.closest(".card");if(e)return void bulkEdit.toggleCardSelection(e)}const i=t.closest(".card .tags .tag");if(i){e.stopPropagation();const t=i.textContent.trim(),a=normalizeString(t);let o=c.querySelector(`input[value="${a}"]`);if(!o){const e=document.createElement("div");e.className="control",e.innerHTML=`\n                    <label class="checkbox">\n                        <input type="checkbox" value="${a}">\n                        <span>${t}</span>\n                    </label>\n                `;const n=c.querySelector(".narrator-only");c.insertBefore(e,n),o=e.querySelector("input")}o&&(o.checked=!o.checked,o.dispatchEvent(new Event("change",{bubbles:!0})))}else;})),n&&n.addEventListener("click",bulkEdit.enterBulkEditMode),o&&o.addEventListener("click",(()=>openModal(p))),document.addEventListener("keydown",(e=>{if("Escape"===e.key){if(bulkEdit.isBulkEditingActive())return void bulkEdit.exitBulkEditMode();const e=document.querySelector(".modal.is-active");if(e)return void closeModal(e);const t=document.querySelector(".is-editing-item");if(t){const e=t.querySelector(".card.editing"),a=e?.querySelector(".cancel-btn");return void(a&&a.click())}const a=document.querySelector(".card.is-details-visible");if(a)return void a.classList.remove("is-details-visible")}})),document.body.addEventListener("change",(e=>{const t=e.target;if(t.classList.contains("hp-current-input")){const e=t.closest(".shortcode-hp");if(!e)return;const{itemId:a,shortcode:o,maxHp:n}=e.dataset,s=parseInt(t.value,10);if(!a||!o||isNaN(s))return;const i=Math.max(0,Math.min(s,parseInt(n,10)));i!==s&&(t.value=i),M(a,o,i,t)}})),document.body.addEventListener("focusout",(e=>{if(e.target.classList.contains("money-value-input")){!async function(e){const t=e.closest(".shortcode-money");if(!t||!t.dataset.itemId)return;const{itemId:a,shortcode:o}=t.dataset,n=allItems.find((e=>e.id===a));if(!n)return;const s=decodeURIComponent(o),i=shortcodeParser._parseArguments(s.slice(1,-1)).slice(1),r=shortcodeParser._parseKeyValueArgs(i),d=parseFloat(r.current)||0,c=e.value.trim().replace(/\./g,"");let l=d;const u=c.match(/^(\d+\.?\d*)\s*([+\-*\/])\s*(\d+\.?\d*)$/);if(u){const e=parseFloat(u[1]),t=u[2],a=parseFloat(u[3]);isNaN(e)||isNaN(a)||("+"===t?l=e+a:"-"===t?l=e-a:"*"===t?l=e*a:"/"===t&&0!==a&&(l=e/a))}else{const e=c.match(/^([+\-*\/])\s*(\d+\.?\d*)$/);if(e){const t=e[1],a=parseFloat(e[2]);isNaN(a)||("+"===t?l=d+a:"-"===t?l=d-a:"*"===t?l=d*a:"/"===t&&0!==a&&(l=d/a))}else isNaN(parseFloat(c))||(l=parseFloat(c))}l=Math.round(100*l)/100;const m=s.replace(/current=([\d\."]+)/,`current="${l}"`),g=n.conteudo.replace(s,m);g!==n.conteudo&&await firebaseService.updateItem(n,{conteudo:g})}(e.target);const t=e.target.closest(".shortcode-money").querySelector(".money-value-display");e.target.classList.add("is-hidden"),t.classList.remove("is-hidden")}})),document.body.addEventListener("keydown",(e=>{if(e.target.classList.contains("money-value-input"))if("Enter"===e.key){e.preventDefault();const t=e.target.closest(".shortcode-money").querySelector(".money-value-display");e.target.classList.add("is-hidden"),t.classList.remove("is-hidden"),e.target.blur()}else if("Escape"===e.key){e.preventDefault();const t=e.target.closest(".shortcode-money"),a=t.querySelector(".money-value-display"),{shortcode:o}=t.dataset,n=decodeURIComponent(o),s=shortcodeParser._parseArguments(n.slice(1,-1)).slice(1),i=shortcodeParser._parseKeyValueArgs(s),r=parseFloat(i.current)||0;e.target.classList.add("is-hidden"),a.classList.remove("is-hidden"),e.target.value=r}})),firebaseService.listenToItems((async e=>{try{if(!isInitialGridLoaded){let t=e.docs.map((e=>({id:e.id,...e.data()})));return auth.isNarrator()||(t=t.filter((e=>!1!==e.isVisibleToPlayers))),allItems=t,allItems.sort(((e,t)=>(e.order||0)-(t.order||0))),await cardManager.loadItems(allItems),isInitialGridLoaded=!0,void q()}}catch(e){console.error("Erro ao processar os dados do Firebase:",e);const t=document.querySelector(".loading-indicator");t&&(t.innerHTML='\n                    <div class="notification is-danger">\n                        Erro ao carregar os cards. <a href="javascript:location.reload()">Tente novamente</a>.\n                    </div>\n                ')}e.docChanges().forEach((e=>{const t={id:e.doc.id,...e.doc.data()},a=allItems.findIndex((e=>e.id===t.id)),o=auth.isNarrator();switch(e.type){case"added":(o||!1!==t.isVisibleToPlayers)&&-1===a&&allItems.push(t);break;case"modified":const e=o||!1!==t.isVisibleToPlayers;a>-1?e?allItems[a]=t:allItems.splice(a,1):e&&allItems.push(t);break;case"removed":if(a>-1&&allItems.splice(a,1),m.classList.contains("is-active")){const e=m.querySelector(".box");e&&e.dataset.itemId===t.id&&closeModal(m)}}})),allItems.sort(((e,t)=>(e.order||0)-(t.order||0))),q()})),s.addEventListener("input",(()=>{q(),F()})),r.addEventListener("input",(()=>{q()})),c.addEventListener("change",(e=>{if("checkbox"===e.target.type){const t=e.target,a=t.value;if(auth.isNarrator()&&(a===VISIBILITY_FILTERS.VISIBLE||a===VISIBILITY_FILTERS.HIDDEN)&&t.checked){const e=a===VISIBILITY_FILTERS.VISIBLE?VISIBILITY_FILTERS.HIDDEN:VISIBILITY_FILTERS.VISIBLE,t=c.querySelector(`input[value="${e}"]`);t&&t.checked&&(t.checked=!1,t.closest("label").classList.remove("is-active"))}t.closest("label").classList.toggle("is-active",t.checked),q(),z(),F()}})),i.addEventListener("click",(e=>{if(e.target.classList.contains("is-delete")){const t=e.target.dataset.value,a=c.querySelector(`input[value="${t}"]`);a&&(a.checked=!1,a.dispatchEvent(new Event("change",{bubbles:!0})))}})),d&&d.addEventListener("click",(()=>{s.value="";c.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.checked=!1,e.closest("label").classList.remove("is-active")})),q(),z(),F()})),a.addEventListener("click",(()=>{v.reset(),grid.updateFileName(h);const e=document.getElementById("card-visibility");auth.isNarrator()&&e&&(e.checked=!1),openModal(g)})),v.addEventListener("submit",(async e=>{e.preventDefault();const t=v.closest(".modal-card").querySelector('button[type="submit"]');t.classList.add("is-loading");const a=h.files.length>0?h.files[0]:null,o=document.getElementById("card-visibility"),n={titulo:document.getElementById("card-titulo").value,conteudo:document.getElementById("card-conteudo").value,descricao:document.getElementById("card-descricao").value,tags:y.value.split(",").map((e=>e.trim())).filter(Boolean),isVisibleToPlayers:!auth.isNarrator()||!o||o.checked};try{if(a){const e=await cardRenderer.getImageDimensions(a);n.width=e.width,n.height=e.height}const e=await firebaseService.addItem(n,a);v.reset(),grid.updateFileName(h),closeModal(g);const t=firebaseService.listenToItems((a=>{a.docs.find((t=>t.id===e))&&setTimeout((()=>{grid.scrollToCard(e),t()}),100)}))}catch(e){console.error("Erro ao adicionar novo card:",e),alert("Falha ao adicionar o novo card.")}finally{t.classList.remove("is-loading")}})),h.addEventListener("change",(()=>grid.updateFileName(h))),t.addEventListener("click",(()=>{const e=t.querySelector(".icon i");l.classList.contains("view-board")?(document.body.classList.remove("body-view-board"),l.classList.remove("view-board"),l.classList.add("view-grid"),t.title="Mudar para Visualização em Board",e.className="fas fa-project-diagram",R("grid"),grid.show()):(document.body.classList.add("body-view-board"),l.classList.remove("view-grid"),l.classList.add("view-board"),t.title="Mudar para Visualização em Grade",e.className="fas fa-th",R("board"),grid.destroy(),_())})),setTimeout((()=>{if("board"===(localStorage.getItem("rpgboard_view_mode")||"grid")){if(document.body.classList.add("body-view-board"),l.classList.remove("view-grid"),l.classList.add("view-board"),t){t.title="Mudar para Visualização em Grade";const e=t.querySelector(".icon i");e&&(e.className="fas fa-th")}grid.hide(),_()}else{if(document.body.classList.remove("body-view-board"),l.classList.remove("view-board"),l.classList.add("view-grid"),t){t.title="Mudar para Visualização em Board";const e=t.querySelector(".icon i");e&&(e.className="fas fa-project-diagram")}grid.show()}}),0),$(y,{suggestions:appSettings.recommendedTags||[]}),$(s,{isMultiTag:!1,showRecsOnFocus:!1}),document.body.addEventListener("click",(async e=>{if(e.target.closest(".modal-card-body")){const t=e.target.closest("pre > code");t&&(await navigator.clipboard.writeText(t.textContent),function(e,t="Copiado!"){const a=document.createElement("div");a.textContent=t,a.className="click-feedback",document.body.appendChild(a),a.style.left=`${e.pageX+15}px`,a.style.top=`${e.pageY}px`,setTimeout((()=>{a.style.opacity="0",setTimeout((()=>{a.remove()}),500)}),700)}(e))}})),window.firebaseInstances&&window.firebaseInstances.db&&window.firebaseInstances.storage||console.error("As instâncias do Firebase não estão configuradas corretamente. Verifique a configuração do Firebase.")}));